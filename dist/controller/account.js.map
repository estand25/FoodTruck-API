{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","register","username","body","email","password","err","account","send","authenticate","session","status","scope","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAkB;AAAA,MAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,MAARC,EAAQ,QAARA,EAAQ;;AAC/B,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAe;AACnC,sBAAQC,QAAR,CAAiB,sBAAY;AAC3BC,gBAAUH,IAAII,IAAJ,CAASC;AADQ,KAAZ,CAAjB,EAEIL,IAAII,IAAJ,CAASE,QAFb,EAEuB,UAASC,GAAT,EAAcC,OAAd,EAAuB;AAC5C,UAAGD,GAAH,EAAO;AACLN,YAAIQ,IAAJ,CAASF,GAAT;AACD;;AAED,yBAASG,YAAT,CACE,OADF,EACW;AACPC,iBAAS;AADF,OADX,EAGKX,GAHL,EAGUC,GAHV,EAGe,YAAK;AAChBA,YAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,kCAArB;AACD,OALH;AAMD,KAbD;AAcD,GAfD;;AAkBA;AACAX,MAAIC,IAAJ,CAAS,QAAT,EAAmB,mBAASW,YAAT,CACjB,OADiB,EACR;AACPC,aAAS,KADF;AAEPE,WAAO;AAFA,GADQ,CAAnB;;AAOA;AACAf,MAAIgB,GAAJ,CAAQ,SAAR,gCAAiC,UAACd,GAAD,EAAKC,GAAL,EAAY;AAC3CA,QAAIc,MAAJ;AACAd,QAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,yBAArB;AACD,GAHD;;AAKAX,MAAIgB,GAAJ,CAAQ,KAAR,gCAA6B,UAACd,GAAD,EAAKC,GAAL,EAAa;AACxCA,QAAIW,MAAJ,CAAW,GAAX,EAAgBI,IAAhB,CAAqBhB,IAAIiB,IAAzB;AACD,GAFD;;AAIA,SAAOnB,GAAP;AACD,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport Account from '../model/account';\r\nimport bodyParser from 'body-parser';\r\nimport passport from 'passport';\r\nimport config from '../config';\r\n\r\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\r\n\r\nexport default ({config, db}) => {\r\n  let api = Router();\r\n\r\n  //'/v1/account'\r\n  api.post('/register', (req, res) =>  {\r\n    Account.register(new Account({\r\n      username: req.body.email\r\n    }), req.body.password, function(err, account) {\r\n      if(err){\r\n        res.send(err);\r\n      }\r\n\r\n      passport.authenticate(\r\n        'local', {\r\n          session: false\r\n        })(req, res, () =>{\r\n          res.status(200).send('Successfully created new account');\r\n        });\r\n    });\r\n  });\r\n\r\n\r\n  // 'v1/account/login'\r\n  api.post('/login', passport.authenticate(\r\n    'local', {\r\n      session: false,\r\n      scope: [],\r\n    }), generateAccessToken, respond);\r\n\r\n\r\n  // 'v1/account/logout'\r\n  api.get('/logout', authenticate, (req,res) =>{\r\n    res.logout();\r\n    res.status(200).send('Successfully logged out');\r\n  });\r\n\r\n  api.get('/me', authenticate, (req,res) => {\r\n    res.status(200).json(req.user);\r\n  });\r\n\r\n  return api;\r\n}\r\n"]}